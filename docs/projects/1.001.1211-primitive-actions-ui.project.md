---
id: primitive-actions-ui
name: Primitive Actions UI
status: active
priority: P1
created: 2025-12-11
---

# Project: Primitive Actions UI

## Quick Start for New Chats

1. Read this file first
2. Find the current phase (marked with `<- CURRENT`)
3. Execute atomic tasks via local models
4. Update task status when complete

---

## Overview

Replace pattern-recognized action buttons (Open, 3bet, Cbet, etc.) with context-aware primitive actions (Check, Bet, Call, Raise, Fold). UI shows only valid actions based on betting state.

**Key Features:**
- Preflop: Check (BB option), Call, Raise, Fold
- Postflop single-seat (no bet): Check, Bet, Fold
- Postflop single-seat (bet exists): Call, Raise, Fold
- Multi-seat selection: All 5 buttons for rapid input
- Primitives-only storage (no legacy dual-write)

---

## Context Files

- `src/components/views/TableView/ActionPanel.jsx` - Main file to modify
- `src/components/ui/ActionSequence.jsx` - Display component
- `src/constants/primitiveActions.js` - PRIMITIVE_ACTIONS constants

---

## Phases

| Phase | Status | Description |
|-------|--------|-------------|
| 1 | [ ] | Create helper functions and button component |
| 2 | [ ] | Update ActionPanel to use new components |
| 3 | [ ] | Update ActionSequence for primitives |
| 4 | [ ] | Remove legacy recording, write tests |

---

## Phase 1: Create Helper Functions <- CURRENT

### Goal
Create the utility functions and button component needed for context-aware actions.

### Atomic Task Decomposition (MANDATORY)

| Task ID | Description | File | Model | Status |
|---------|-------------|------|-------|--------|
| T-001 | Create `getValidActions` helper | `src/utils/actionUtils.js` | deepseek | [ ] |
| T-002 | Create `hasBetOnStreet` detector | `src/utils/actionUtils.js` | deepseek | [ ] |
| T-003 | Create `PrimitiveActionButton` component | `src/components/ui/PrimitiveActionButton.jsx` | deepseek | [ ] |
| T-004 | Create `PRIMITIVE_BUTTON_CONFIG` constant | `src/constants/primitiveActions.js` | deepseek | [ ] |
| T-005 | Write tests for `getValidActions` | `src/utils/__tests__/actionUtils.primitives.test.js` | qwen | [ ] |
| T-006 | Write tests for `hasBetOnStreet` | `src/utils/__tests__/actionUtils.primitives.test.js` | qwen | [ ] |

**Task Spec Location**: `.claude/task-specs/primitive-actions-ui/`

### Task Specs

<details>
<summary>T-001: getValidActions helper</summary>

```json
{
  "task_id": "T-001",
  "model": "deepseek",
  "type": "create",
  "description": "Create getValidActions function that returns array of valid primitive actions based on street, betting state, and selection mode",
  "output_file": "src/utils/actionUtils.js",
  "function_name": "getValidActions",
  "context_files": ["src/constants/primitiveActions.js"],
  "inputs": "street: string, hasBet: boolean|null, isMultiSeat: boolean",
  "outputs": "Array of PRIMITIVE_ACTIONS values",
  "constraints": [
    "Import PRIMITIVE_ACTIONS from '../constants/primitiveActions'",
    "If isMultiSeat, return all 5 actions: [CHECK, BET, CALL, RAISE, FOLD]",
    "If preflop, return [CHECK, CALL, RAISE, FOLD] (Check for BB option)",
    "If postflop and hasBet=false, return [CHECK, BET, FOLD]",
    "If postflop and hasBet=true, return [CALL, RAISE, FOLD]",
    "Export as named function",
    "Include JSDoc with @param and @returns"
  ],
  "example_usage": "getValidActions('preflop', true, false) => ['check', 'call', 'raise', 'fold']",
  "max_lines": 25
}
```
</details>

<details>
<summary>T-002: hasBetOnStreet detector</summary>

```json
{
  "task_id": "T-002",
  "model": "deepseek",
  "type": "create",
  "description": "Create hasBetOnStreet function that checks if any seat has recorded a BET or RAISE action on the current street",
  "output_file": "src/utils/actionUtils.js",
  "function_name": "hasBetOnStreet",
  "context_files": ["src/constants/primitiveActions.js"],
  "inputs": "seatActions: object, currentStreet: string",
  "outputs": "boolean - true if any bet/raise exists on street",
  "constraints": [
    "Import PRIMITIVE_ACTIONS from '../constants/primitiveActions'",
    "Get actions for currentStreet from seatActions object",
    "Flatten all seat arrays and check for BET or RAISE",
    "Return false if no actions exist for street",
    "Export as named function",
    "Include JSDoc"
  ],
  "example_usage": "hasBetOnStreet({flop: {1: ['bet']}}, 'flop') => true",
  "max_lines": 15
}
```
</details>

<details>
<summary>T-003: PrimitiveActionButton component</summary>

```json
{
  "task_id": "T-003",
  "model": "deepseek",
  "type": "create",
  "description": "Create reusable PrimitiveActionButton component for action buttons",
  "output_file": "src/components/ui/PrimitiveActionButton.jsx",
  "function_name": "PrimitiveActionButton",
  "context_files": ["src/constants/primitiveActions.js"],
  "inputs": "action: string, onClick: function, disabled: boolean",
  "outputs": "React button element with appropriate styling",
  "constraints": [
    "Import React and PropTypes",
    "Use PRIMITIVE_BUTTON_CONFIG for label and color (import from constants)",
    "Apply Tailwind classes: py-4 rounded-lg font-bold text-base",
    "Add hover state",
    "Include PropTypes validation",
    "Export as named function"
  ],
  "example_usage": "<PrimitiveActionButton action='fold' onClick={handleFold} />",
  "max_lines": 30
}
```
</details>

<details>
<summary>T-004: PRIMITIVE_BUTTON_CONFIG constant</summary>

```json
{
  "task_id": "T-004",
  "model": "deepseek",
  "type": "modify",
  "description": "Add PRIMITIVE_BUTTON_CONFIG constant mapping actions to labels and colors",
  "output_file": "src/constants/primitiveActions.js",
  "context_files": ["src/constants/primitiveActions.js"],
  "constraints": [
    "Add after existing PRIMITIVE_ACTIONS constant",
    "Map each primitive action to {label, bgColor, hoverColor, textColor}",
    "Colors: check=blue-400, bet=green-400, call=blue-300, raise=orange-400, fold=red-400",
    "Labels: Check, Bet, Call, Raise, Fold",
    "Export as named constant"
  ],
  "max_lines": 20
}
```
</details>

<details>
<summary>T-005: Tests for getValidActions</summary>

```json
{
  "task_id": "T-005",
  "model": "qwen",
  "type": "create",
  "description": "Write unit tests for getValidActions function",
  "output_file": "src/utils/__tests__/actionUtils.primitives.test.js",
  "context_files": ["src/utils/actionUtils.js", "src/constants/primitiveActions.js"],
  "constraints": [
    "Use vitest (describe, it, expect)",
    "Test preflop returns [check, call, raise, fold]",
    "Test postflop no bet returns [check, bet, fold]",
    "Test postflop with bet returns [call, raise, fold]",
    "Test multi-seat returns all 5 actions",
    "Import PRIMITIVE_ACTIONS for assertions"
  ],
  "max_lines": 40
}
```
</details>

<details>
<summary>T-006: Tests for hasBetOnStreet</summary>

```json
{
  "task_id": "T-006",
  "model": "qwen",
  "type": "create",
  "description": "Write unit tests for hasBetOnStreet function",
  "output_file": "src/utils/__tests__/actionUtils.primitives.test.js",
  "context_files": ["src/utils/actionUtils.js", "src/constants/primitiveActions.js"],
  "constraints": [
    "Add to same test file as T-005",
    "Test returns false when no actions",
    "Test returns false when only checks/folds",
    "Test returns true when bet exists",
    "Test returns true when raise exists",
    "Test handles empty seatActions object"
  ],
  "max_lines": 35
}
```
</details>

### Execution Order
1. [ ] T-004: Add config constant first (dependency for T-003)
2. [ ] T-001: Create getValidActions
3. [ ] T-002: Create hasBetOnStreet
4. [ ] T-003: Create PrimitiveActionButton
5. [ ] T-005: Write tests for getValidActions
6. [ ] T-006: Write tests for hasBetOnStreet
7. [ ] Run tests: `npm test -- actionUtils.primitives`

### Claude-Only Tasks
None planned. All tasks decomposed for local models.

---

## Phase 2: Update ActionPanel

### Goal
Replace button sections in ActionPanel with new components.

### Atomic Task Decomposition

| Task ID | Description | File | Model | Status |
|---------|-------------|------|-------|--------|
| T-007 | Update imports in ActionPanel | `ActionPanel.jsx` | qwen | [ ] |
| T-008 | Add context detection logic | `ActionPanel.jsx` | deepseek | [ ] |
| T-009 | Replace preflop buttons section | `ActionPanel.jsx` | deepseek | [ ] |
| T-010 | Replace postflop buttons section | `ActionPanel.jsx` | deepseek | [ ] |
| T-011 | Update handleRecordAction for primitives-only | `ActionPanel.jsx` | qwen | [ ] |

---

## Phase 3: Update ActionSequence

### Atomic Task Decomposition

| Task ID | Description | File | Model | Status |
|---------|-------------|------|-------|--------|
| T-012 | Add PRIMITIVE_ABBREV constant | `primitiveActions.js` | qwen | [ ] |
| T-013 | Update ActionSequence to handle primitives | `ActionSequence.jsx` | deepseek | [ ] |
| T-014 | Write tests for ActionSequence primitives | `ActionSequence.test.js` | qwen | [ ] |

---

## Phase 4: Cleanup and Testing

### Atomic Task Decomposition

| Task ID | Description | File | Model | Status |
|---------|-------------|------|-------|--------|
| T-015 | Remove legacy onRecordAction prop | `ActionPanel.jsx` | qwen | [ ] |
| T-016 | Remove unused ACTIONS imports | `ActionPanel.jsx` | qwen | [ ] |
| T-017 | Update ActionPanel PropTypes | `ActionPanel.jsx` | qwen | [ ] |
| T-018 | Integration test - manual verification | N/A | Claude | [ ] |

---

## Decisions Log

| Date | Decision | Rationale |
|------|----------|-----------|
| 2025-12-11 | Context-aware primitives | Show only valid actions based on betting state |
| 2025-12-11 | BB can Check preflop | Support BB option when limped to |
| 2025-12-11 | All 5 for multi-seat | Enables rapid input for bulk actions |
| 2025-12-11 | Decompose into 18 atomic tasks | Local model delegation mandate |

---

## Session Log

| Date | Session | Phase | Work Done |
|------|---------|-------|-----------|
| 2025-12-11 | Initial | Planning | Created plan, answered clarifying questions |
| 2025-12-11 | Session 2 | Setup | Created project file, decomposed into atomic tasks |

---

## Completion Checklist

- [ ] All 18 atomic tasks completed via local models
- [ ] Tests passing
- [ ] Documentation updated
- [ ] Committed with descriptive message
